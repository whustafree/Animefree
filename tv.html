<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Whustaf TV</title>
    <style>
        /* --- ESTILOS BASE TV --- */
        :root { --primary: #ff4757; --bg: #0f0f0f; --focus: white; }
        * { box-sizing: border-box; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; padding: 0; background: var(--bg); color: white; 
            font-family: 'Segoe UI', sans-serif; overflow: hidden; 
            height: 100vh; width: 100vw; font-size: 1.5vw; /* Texto base escalable */
        }

        /* --- PANTALLA DE BLOQUEO VERTICAL --- */
        .rotate-overlay {
            display: none; position: fixed; inset: 0; background: #000; z-index: 99999;
            flex-direction: column; align-items: center; justify-content: center; text-align: center;
        }
        .rotate-icon { font-size: 80px; animation: rotatePhone 2s infinite ease-in-out; margin-bottom: 20px; }
        
        /* MAGIA: Si la pantalla es vertical (Portrait), activa el bloqueo */
        @media screen and (orientation: portrait) {
            .rotate-overlay { display: flex !important; }
            .tv-container, #app-background, .vignette { display: none !important; }
        }

        @keyframes rotatePhone {
            0%, 10% { transform: rotate(0deg); }
            40%, 60% { transform: rotate(90deg); }
            90%, 100% { transform: rotate(0deg); }
        }

        /* --- FONDO DIN√ÅMICO --- */
        #app-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center top;
            opacity: 0.35; z-index: -1; transition: background-image 0.5s ease-in-out;
            mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 100%);
            -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 100%);
        }
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 70% 30%, transparent 0%, var(--bg) 90%);
            z-index: -1;
        }

        /* --- LAYOUT PRINCIPAL --- */
        .tv-container { display: flex; height: 100%; width: 100%; }

        /* --- MEN√ö LATERAL (RAIL) --- */
        /* Ahora usa unidades vw/vh para adaptarse al tama√±o de la TV */
        .sidebar {
            width: 6vw; min-width: 70px; background: rgba(0,0,0,0.85); display: flex; flex-direction: column;
            align-items: center; padding-top: 4vh; z-index: 100; transition: width 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            backdrop-filter: blur(10px); border-right: 1px solid rgba(255,255,255,0.1);
        }
        /* Al enfocar, el men√∫ crece */
        .sidebar:has(:focus-within) { width: 18vw; min-width: 200px; align-items: flex-start; padding-left: 2vw; }
        
        .logo { font-weight:bold; color:var(--primary); font-size: 2vw; margin-bottom: 4vh; transition: 0.3s; }
        .sidebar:has(:focus-within) .logo { font-size: 2.5vw; }

        .nav-btn {
            background: transparent; border: none; color: #aaa; padding: 1.5vh; margin-bottom: 1.5vh;
            border-radius: 1vw; font-size: 2vw; cursor: pointer; display: flex; align-items: center; gap: 1.5vw;
            width: 4vw; height: 4vw; transition: 0.2s; overflow: hidden; white-space: nowrap; justify-content: center;
        }
        .sidebar:has(:focus-within) .nav-btn { width: 14vw; height: auto; justify-content: flex-start; padding-left: 1.5vw; }
        
        .nav-btn span { font-size: 1.2vw; opacity: 0; transition: 0.2s; font-weight: 600; }
        .sidebar:has(:focus-within) .nav-btn span { opacity: 1; }
        
        .nav-btn.active { color: var(--primary); background: rgba(255,71,87,0.1); }
        .nav-btn:focus { background: var(--focus); color: black; transform: scale(1.05); box-shadow: 0 0 30px rgba(255,255,255,0.3); }

        /* --- √ÅREA DE CONTENIDO --- */
        .content-area { flex: 1; padding: 4vh 4vw; overflow: hidden; display: flex; flex-direction: column; position: relative; }

        /* --- META INFO (TITULO GIGANTE) --- */
        .meta-info { height: 35%; display: flex; flex-direction: column; justify-content: flex-end; margin-bottom: 3vh; }
        .meta-tag { background: var(--primary); color: white; padding: 0.5vh 1vw; border-radius: 0.5vw; font-weight: bold; font-size: 1vw; width: fit-content; margin-bottom: 1vh; }
        .meta-title { font-size: 4vw; font-weight: 800; margin: 0; text-shadow: 2px 2px 10px rgba(0,0,0,0.8); line-height: 1.1; }
        .meta-desc { font-size: 1.1vw; color: #ddd; margin-top: 1.5vh; max-width: 60vw; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-shadow: 1px 1px 5px black; }

        /* --- LISTAS HORIZONTALES --- */
        .rows-container { flex: 1; overflow-y: auto; padding-bottom: 5vh; scroll-behavior: smooth; }
        .rows-container::-webkit-scrollbar { display: none; }
        
        .row-title { font-size: 1.5vw; color: #fff; margin-bottom: 2vh; font-weight: 600; padding-left: 0.5vw; opacity: 0.9; margin-top: 2vh; }
        
        .row-scroller { display: flex; gap: 1.5vw; padding: 1vh 0.5vw 4vh 0.5vw; overflow-x: auto; scrollbar-width: none; }
        .row-scroller::-webkit-scrollbar { display: none; }

        /* --- TARJETAS (ADAPTATIVAS) --- */
        .card {
            /* Tama√±o basado en el ancho de la pantalla */
            min-width: 13vw; height: 19vw; border-radius: 1vw; position: relative;
            background-size: cover; background-position: center; cursor: pointer; background-color: #222;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.2s ease; 
            border: 0.3vw solid transparent;
        }
        .card:focus { transform: scale(1.1); border-color: white; box-shadow: 0 10px 40px rgba(0,0,0,0.8); z-index: 10; }

        /* --- BUSCADOR --- */
        .search-container { display: none; padding: 2vh; height: 100%; flex-direction: column; }
        .search-container.active { display: flex; }
        .search-input { 
            background: rgba(255,255,255,0.1); border: 2px solid transparent; color: white; 
            font-size: 2vw; padding: 1.5vh 2vw; border-radius: 5vw; width: 100%; margin-bottom: 4vh; 
        }
        .search-input:focus { background: rgba(255,255,255,0.2); border-color: var(--primary); }

        /* --- MODAL DETALLES --- */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 200; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .modal-content { display: flex; width: 85%; height: 80%; gap: 3vw; }
        .modal-img { width: 22vw; height: 32vw; object-fit: cover; border-radius: 1vw; box-shadow: 0 0 50px rgba(255,71,87,0.2); }
        .modal-info { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .modal-title { font-size: 3vw; margin-bottom: 2vh; font-weight: bold; line-height: 1.1; }
        .modal-desc { font-size: 1.2vw; color: #ccc; line-height: 1.5; margin-bottom: 4vh; max-height: 20vh; overflow-y: auto; }
        
        .action-row { display: flex; gap: 1.5vw; margin-bottom: 4vh; }
        .btn-action { padding: 1.5vh 3vw; border-radius: 0.8vw; font-size: 1.2vw; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-primary { background: white; color: black; }
        .btn-primary:focus { background: var(--primary); color: white; transform: scale(1.1); }
        .btn-sec { background: rgba(255,255,255,0.15); color: white; }
        .btn-sec:focus { background: white; color: black; transform: scale(1.1); }
        
        .ep-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(6vw, 1fr)); gap: 1vw; 
            overflow-y: auto; padding: 1vh; flex: 1; 
        }
        .ep-btn { background: #333; color: white; border: none; padding: 1.5vh; border-radius: 0.5vw; cursor: pointer; font-size: 1vw; }
        .ep-btn:focus { background: var(--primary); transform: scale(1.1); outline: 2px solid white; }

        /* --- PLAYER --- */
        .player-overlay { display: none; position: fixed; inset: 0; background: black; z-index: 300; }
        .close-player { position: absolute; top: 3vh; right: 3vw; padding: 1vh 2vw; background: rgba(255,0,0,0.5); color: white; border: none; font-size: 1.5vw; border-radius: 0.5vw; z-index: 301;}
        .close-player:focus { background: red; transform: scale(1.1); border: 2px solid white; }

        /* --- LOADER --- */
        .loader { border: 0.5vw solid #333; border-top: 0.5vw solid var(--primary); border-radius: 50%; width: 4vw; height: 4vw; animation: spin 1s linear infinite; margin: 10vh auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="rotate-overlay">
        <div class="rotate-icon">üì±‚û°Ô∏èüì∫</div>
        <h1>Modo TV Detectado</h1>
        <p style="font-size: 18px; color: #ccc;">Esta aplicaci√≥n est√° dise√±ada para televisiones.<br>Por favor, gira tu dispositivo a horizontal.</p>
    </div>

    <div id="app-background"></div>
    <div class="vignette"></div>

    <div class="tv-container">
        <div class="sidebar" id="sidebar">
            <div class="logo">W</div>
            
            <button id="nav-home" class="nav-btn active" onclick="loadView('home')">
                <i>üè†</i> <span>Inicio</span>
            </button>
            <button id="nav-search" class="nav-btn" onclick="loadView('search')">
                <i>üîç</i> <span>Buscar</span>
            </button>
            <button id="nav-favs" class="nav-btn" onclick="loadView('favs')">
                <i>‚ù§Ô∏è</i> <span>Lista</span>
            </button>
            <button id="nav-clean" class="nav-btn" style="margin-top:auto;" onclick="borrarCaches()">
                <i>üßπ</i> <span>Limpiar</span>
            </button>
        </div>

        <div class="content-area">
            
            <div id="view-home" class="view-section">
                <div class="meta-info">
                    <div class="meta-tag" id="meta-tag">ESTRENO</div>
                    <h1 class="meta-title" id="meta-title">Whustaf TV</h1>
                    <p class="meta-desc" id="meta-desc">Bienvenido. Usa las flechas de tu control remoto para navegar. Selecciona un anime para ver m√°s detalles.</p>
                </div>

                <div class="rows-container">
                    <div class="row-title">üî• Estrenos Recientes</div>
                    <div class="row-scroller" id="row-latest"></div>

                    <div class="row-title">‚ù§Ô∏è Tu Lista</div>
                    <div class="row-scroller" id="row-favs"></div>
                </div>
            </div>

            <div id="view-search" class="search-container">
                <h1 style="margin-bottom: 2vh; font-size: 3vw;">Buscador</h1>
                <input type="text" id="search-input" class="search-input" placeholder="Escribe el nombre del anime...">
                <div class="rows-container">
                    <div class="row-scroller" id="search-results" style="flex-wrap: wrap; overflow-y: auto;"></div>
                </div>
            </div>

            <div id="view-favs" class="search-container">
                <h1 style="margin-bottom: 2vh; font-size: 3vw;">Mi Lista</h1>
                <div class="rows-container">
                    <div class="row-scroller" id="favs-grid" style="flex-wrap: wrap; overflow-y: auto;"></div>
                </div>
            </div>

        </div>
    </div>

    <div id="modal-detail" class="modal">
        <div class="modal-content">
            <img id="mod-img" class="modal-img">
            <div class="modal-info">
                <h2 id="mod-title" class="modal-title">Titulo</h2>
                <p id="mod-desc" class="modal-desc">Descripcion...</p>
                <div class="action-row">
                    <button id="btn-play" class="btn-action btn-primary">‚ñ∂ Reproducir</button>
                    <button id="btn-fav" class="btn-action btn-sec">Lista</button>
                    <button onclick="closeModal()" class="btn-action btn-sec">Cerrar</button>
                </div>
                <h3 style="font-size: 1.5vw; margin-bottom: 1.5vh;">Episodios</h3>
                <div id="mod-episodes" class="ep-grid"></div>
            </div>
        </div>
    </div>

    <div id="player-overlay" class="player-overlay">
        <div id="player-container" style="width:100%; height:100%;"></div>
        <button class="close-player" onclick="closePlayer()">Salir</button>
    </div>

    <script src="app_tv.js?v=adaptive_v2"></script>
</body>
</html>