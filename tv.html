<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Whustaf TV</title>
    <style>
        /* --- ESTILOS BASE TV --- */
        :root { --primary: #ff4757; --bg: #0f0f0f; --surface: #1e1e1e; --focus: white; }
        * { box-sizing: border-box; outline: none; user-select: none; }
        body { margin: 0; padding: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; width: 100vw; }

        /* --- FONDO DIN√ÅMICO (LA MAGIA) --- */
        #app-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center top;
            opacity: 0.4; z-index: -1; transition: background-image 0.5s ease-in-out;
            mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0.1) 100%);
            -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0.1) 100%);
        }
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 70% 20%, transparent 0%, var(--bg) 90%);
            z-index: -1;
        }

        /* --- LAYOUT PRINCIPAL --- */
        .tv-container { display: flex; height: 100%; }

        /* --- MEN√ö LATERAL (RAIL) --- */
        .sidebar {
            width: 80px; background: rgba(0,0,0,0.8); display: flex; flex-direction: column;
            align-items: center; padding-top: 40px; z-index: 100; transition: width 0.3s;
            backdrop-filter: blur(10px); border-right: 1px solid rgba(255,255,255,0.1);
        }
        .sidebar:has(:focus-within) { width: 220px; align-items: flex-start; padding-left: 20px; }
        
        .nav-btn {
            background: transparent; border: none; color: #aaa; padding: 15px; margin-bottom: 10px;
            border-radius: 12px; font-size: 24px; cursor: pointer; display: flex; align-items: center; gap: 15px;
            width: 50px; transition: 0.2s; overflow: hidden; white-space: nowrap;
        }
        .sidebar:has(:focus-within) .nav-btn { width: 180px; }
        .nav-btn span { font-size: 18px; opacity: 0; transition: 0.2s; }
        .sidebar:has(:focus-within) .nav-btn span { opacity: 1; }
        
        .nav-btn.active { color: var(--primary); }
        .nav-btn:focus { background: var(--focus); color: black; transform: scale(1.05); box-shadow: 0 0 20px rgba(255,255,255,0.5); }

        /* --- √ÅREA DE CONTENIDO --- */
        .content-area { flex: 1; padding: 40px 60px; overflow: hidden; display: flex; flex-direction: column; }

        /* --- META INFO (TITULO GIGANTE) --- */
        .meta-info { height: 35%; display: flex; flex-direction: column; justify-content: flex-end; margin-bottom: 20px; transition: 0.3s; }
        .meta-tag { background: var(--primary); color: white; padding: 5px 12px; border-radius: 4px; font-weight: bold; font-size: 14px; width: fit-content; margin-bottom: 10px; }
        .meta-title { font-size: 60px; font-weight: 800; margin: 0; text-shadow: 2px 2px 10px rgba(0,0,0,0.8); line-height: 1; }
        .meta-desc { font-size: 20px; color: #ddd; margin-top: 15px; max-width: 800px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-shadow: 1px 1px 5px black; }

        /* --- LISTAS HORIZONTALES (CARROUSEL) --- */
        .rows-container { flex: 1; overflow-y: auto; padding-bottom: 50px; scroll-behavior: smooth; mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent); }
        .row-title { font-size: 24px; color: #fff; margin-bottom: 15px; font-weight: 600; padding-left: 5px; opacity: 0.9; }
        .row-scroller { display: flex; gap: 20px; padding: 10px 5px 40px 5px; overflow-x: auto; scrollbar-width: none; }
        .row-scroller::-webkit-scrollbar { display: none; }

        /* --- TARJETAS (CARDS) --- */
        .card {
            min-width: 200px; height: 300px; border-radius: 12px; position: relative;
            background-size: cover; background-position: center; cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease; border: 3px solid transparent;
        }
        .card:focus { transform: scale(1.1); border-color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.8); z-index: 10; }
        /* T√≠tulo dentro de la carta solo si no est√° en foco (opcional, aqu√≠ lo quitamos para limpieza) */
        .card-overlay { 
            position: absolute; bottom: 0; width: 100%; background: linear-gradient(transparent, black); 
            padding: 10px; opacity: 0.8; border-radius: 0 0 10px 10px;
        }
        .card-title { font-size: 14px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- BUSCADOR --- */
        .search-container { display: none; padding: 20px; height: 100%; flex-direction: column; }
        .search-container.active { display: flex; }
        .search-input { 
            background: rgba(255,255,255,0.1); border: 2px solid transparent; color: white; 
            font-size: 24px; padding: 15px 25px; border-radius: 50px; width: 100%; margin-bottom: 30px; 
        }
        .search-input:focus { background: rgba(255,255,255,0.2); border-color: var(--primary); }

        /* --- MODAL DETALLES & PLAYER --- */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 200; align-items: center; justify-content: center; backdrop-filter: blur(20px); }
        .modal-content { display: flex; width: 90%; height: 80%; gap: 40px; }
        .modal-img { width: 350px; height: 500px; object-fit: cover; border-radius: 12px; box-shadow: 0 0 50px rgba(255,71,87,0.3); }
        .modal-info { flex: 1; display: flex; flex-direction: column; }
        .modal-title { font-size: 48px; margin-bottom: 20px; }
        .modal-desc { font-size: 18px; color: #ccc; line-height: 1.6; margin-bottom: 30px; }
        .action-row { display: flex; gap: 15px; margin-bottom: 30px; }
        .btn-action { padding: 12px 30px; border-radius: 8px; font-size: 18px; border: none; cursor: pointer; font-weight: bold; }
        .btn-primary { background: white; color: black; }
        .btn-primary:focus { background: var(--primary); color: white; transform: scale(1.1); }
        .btn-sec { background: rgba(255,255,255,0.2); color: white; }
        .btn-sec:focus { background: white; color: black; transform: scale(1.1); }
        
        .ep-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px; overflow-y: auto; padding: 10px; }
        .ep-btn { background: #333; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; }
        .ep-btn:focus { background: var(--primary); transform: scale(1.1); }

        .player-overlay { display: none; position: fixed; inset: 0; background: black; z-index: 300; }
        .close-player { position: absolute; top: 20px; right: 20px; padding: 10px 20px; background: rgba(255,0,0,0.5); color: white; border: none; font-size: 20px; border-radius: 5px; z-index: 301;}
        .close-player:focus { background: red; }

        /* Loader */
        .loader { border: 4px solid #333; border-top: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 50px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="app-background"></div>
    <div class="vignette"></div>

    <div class="tv-container">
        <div class="sidebar" id="sidebar">
            <div class="logo" style="font-weight:bold; color:var(--primary); font-size:24px; margin-bottom:40px;">W</div>
            
            <button id="nav-home" class="nav-btn active" onclick="loadView('home')">
                <i>üè†</i> <span>Inicio</span>
            </button>
            <button id="nav-search" class="nav-btn" onclick="loadView('search')">
                <i>üîç</i> <span>Buscar</span>
            </button>
            <button id="nav-favs" class="nav-btn" onclick="loadView('favs')">
                <i>‚ù§Ô∏è</i> <span>Lista</span>
            </button>
            <button id="nav-clean" class="nav-btn" style="margin-top:auto;" onclick="borrarCaches()">
                <i>üßπ</i> <span>Limpiar</span>
            </button>
        </div>

        <div class="content-area">
            
            <div id="view-home" class="view-section">
                <div class="meta-info">
                    <div class="meta-tag" id="meta-tag">ESTRENO</div>
                    <h1 class="meta-title" id="meta-title">Whustaf TV</h1>
                    <p class="meta-desc" id="meta-desc">Selecciona un anime para ver los detalles. El fondo cambiar√° autom√°ticamente.</p>
                </div>

                <div class="rows-container">
                    <div class="row-title">üî• Estrenos Recientes</div>
                    <div class="row-scroller" id="row-latest">
                        </div>

                    <div class="row-title" style="margin-top: 30px;">‚ù§Ô∏è Tu Lista</div>
                    <div class="row-scroller" id="row-favs"></div>
                </div>
            </div>

            <div id="view-search" class="search-container">
                <h1 style="margin-bottom: 20px;">Buscador</h1>
                <input type="text" id="search-input" class="search-input" placeholder="Escribe el nombre...">
                <div class="rows-container">
                    <div class="row-scroller" id="search-results" style="flex-wrap: wrap; overflow-y: auto;"></div>
                </div>
            </div>

            <div id="view-favs" class="search-container">
                <h1>Mi Lista</h1>
                <div class="rows-container">
                    <div class="row-scroller" id="favs-grid" style="flex-wrap: wrap; overflow-y: auto;"></div>
                </div>
            </div>

        </div>
    </div>

    <div id="modal-detail" class="modal">
        <div class="modal-content">
            <img id="mod-img" class="modal-img">
            <div class="modal-info">
                <h2 id="mod-title" class="modal-title">Titulo</h2>
                <p id="mod-desc" class="modal-desc">Descripcion...</p>
                <div class="action-row">
                    <button id="btn-play" class="btn-action btn-primary">‚ñ∂ Reproducir</button>
                    <button id="btn-fav" class="btn-action btn-sec">A√±adir a Lista</button>
                    <button onclick="closeModal()" class="btn-action btn-sec">Cerrar</button>
                </div>
                <h3>Episodios</h3>
                <div id="mod-episodes" class="ep-grid"></div>
            </div>
        </div>
    </div>

    <div id="player-overlay" class="player-overlay">
        <div id="player-container" style="width:100%; height:100%;"></div>
        <button class="close-player" onclick="closePlayer()">Salir</button>
    </div>

    <script src="app_tv.js?v=immersive_v1"></script>
</body>
</html>