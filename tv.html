<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Whustaf TV</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- ESTILOS BASE TV --- */
        :root { --primary: #ff4757; --bg: #0f0f0f; --focus: white; }
        * { box-sizing: border-box; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; padding: 0; background: var(--bg); color: white; 
            font-family: 'Segoe UI', sans-serif; overflow: hidden; 
            height: 100vh; width: 100vw;
        }

        /* --- FONDO DIN√ÅMICO --- */
        #app-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center top;
            opacity: 0.35; z-index: -1; transition: opacity 0.5s ease;
        }
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 70% 30%, transparent 0%, var(--bg) 90%);
            z-index: -1;
        }

        /* --- LAYOUT PRINCIPAL --- */
        .tv-container { display: flex; height: 100%; width: 100%; }

        /* --- MEN√ö LATERAL --- */
        .sidebar {
            width: 80px;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            align-items: center; padding-top: 30px; z-index: 100; 
            transition: width 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            border-right: 1px solid #333;
        }
        
        /* Expansi√≥n del men√∫ al tener el foco dentro */
        .sidebar:focus-within { width: 240px; align-items: flex-start; padding-left: 20px; }
        
        .logo { font-weight:bold; color:var(--primary); font-size: 24px; margin-bottom: 40px; align-self: center; }
        
        .nav-btn {
            background: transparent; border: none; color: #aaa; 
            height: 60px; width: 100%;
            display: flex; align-items: center; gap: 20px;
            padding: 0 20px; margin-bottom: 10px;
            border-radius: 10px; font-size: 24px; cursor: pointer; 
            overflow: hidden; white-space: nowrap;
            transition: all 0.2s;
        }
        
        .nav-btn span { font-size: 18px; opacity: 0; transition: 0.2s; font-weight: 600; }
        /* Mostrar texto al expandir */
        .sidebar:focus-within .nav-btn span { opacity: 1; }
        
        .nav-btn.active { color: var(--primary); background: rgba(255,71,87,0.1); }
        .nav-btn:focus { background: var(--focus); color: black; transform: scale(1.05); box-shadow: 0 0 20px rgba(255,255,255,0.3); }

        /* --- √ÅREA DE CONTENIDO --- */
        .content-area { flex: 1; padding: 40px; overflow: hidden; display: flex; flex-direction: column; }

        /* --- META INFO --- */
        .meta-info { height: 35%; display: flex; flex-direction: column; justify-content: flex-end; margin-bottom: 20px; }
        .meta-tag { background: var(--primary); color: white; padding: 5px 15px; border-radius: 5px; font-weight: bold; font-size: 14px; width: fit-content; margin-bottom: 10px; }
        .meta-title { font-size: 4vw; font-weight: 800; margin: 0; line-height: 1.1; text-shadow: 2px 2px 10px black; }
        .meta-desc { font-size: 1.2vw; color: #ddd; margin-top: 15px; max-width: 70%; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-shadow: 1px 1px 5px black; }

        /* --- LISTAS --- */
        .rows-container { flex: 1; overflow-y: auto; padding-bottom: 50px; scroll-behavior: smooth; }
        .rows-container::-webkit-scrollbar { display: none; }
        .row-title { font-size: 24px; color: #fff; margin: 20px 0 15px 5px; font-weight: 600; }
        .row-scroller { display: flex; gap: 20px; padding: 10px 5px 30px 5px; overflow-x: auto; scrollbar-width: none; }
        
        /* --- TARJETAS --- */
        .card {
            min-width: 200px; height: 300px; border-radius: 12px; position: relative;
            background-size: cover; background-position: center; cursor: pointer; background-color: #222;
            border: 3px solid transparent; transition: transform 0.2s;
        }
        .card:focus { transform: scale(1.1); border-color: white; box-shadow: 0 10px 40px rgba(0,0,0,0.8); z-index: 10; }

        /* --- BUSCADOR --- */
        .search-container { display: none; padding: 20px; height: 100%; flex-direction: column; }
        .search-container.active { display: flex; }
        .search-input { 
            background: rgba(255,255,255,0.1); border: 2px solid transparent; color: white; 
            font-size: 24px; padding: 15px 25px; border-radius: 50px; width: 100%; margin-bottom: 30px; 
        }
        .search-input:focus { background: rgba(255,255,255,0.2); border-color: var(--primary); }

        /* --- MODAL DETALLES --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 200; align-items: center; justify-content: center; }
        .modal-content { display: flex; width: 90%; height: 85%; gap: 40px; }
        .modal-img { width: 350px; height: 500px; object-fit: cover; border-radius: 12px; }
        .modal-info { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .modal-title { font-size: 48px; margin-bottom: 20px; font-weight: bold; }
        .modal-desc { font-size: 18px; color: #ccc; margin-bottom: 30px; max-height: 150px; overflow-y: auto; }
        
        .action-row { display: flex; gap: 20px; margin-bottom: 30px; }
        .btn-action { padding: 15px 30px; border-radius: 8px; font-size: 18px; border: none; cursor: pointer; font-weight: bold; }
        .btn-primary { background: white; color: black; }
        .btn-primary:focus { background: var(--primary); color: white; transform: scale(1.1); }
        .btn-sec { background: #333; color: white; }
        .btn-sec:focus { background: white; color: black; transform: scale(1.1); }
        
        .ep-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; 
            overflow-y: auto; padding: 10px; flex: 1; 
        }
        .ep-btn { background: #222; color: white; border: 1px solid #444; padding: 15px; border-radius: 8px; cursor: pointer; }
        .ep-btn:focus { background: var(--primary); border-color: var(--primary); transform: scale(1.1); }

        /* --- PLAYER & SERVER SELECTOR --- */
        .player-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 300; flex-direction: column; justify-content: center; align-items: center; }
        
        .server-selector {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 301;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .server-title { font-size: 32px; margin-bottom: 30px; }
        .server-list { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .server-btn { padding: 20px 40px; font-size: 20px; background: #333; color: white; border: none; border-radius: 10px; cursor: pointer; }
        .server-btn:focus { background: var(--primary); transform: scale(1.1); }

        .close-player { position: absolute; top: 30px; right: 30px; padding: 15px 30px; background: rgba(255,0,0,0.5); color: white; border: none; font-size: 20px; border-radius: 8px; z-index: 302; cursor: pointer; }
        .close-player:focus { background: red; border: 2px solid white; }

        /* Loader */
        .loader { border: 5px solid #333; border-top: 5px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 50px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="app-background"></div>
    <div class="vignette"></div>

    <div class="tv-container" id="main-ui">
        <div class="sidebar" id="sidebar">
            <div class="logo">W</div>
            
            <button id="nav-home" class="nav-btn active" onclick="loadView('home')">
                <i>üè†</i> <span>Inicio</span>
            </button>
            <button id="nav-search" class="nav-btn" onclick="loadView('search')">
                <i>üîç</i> <span>Buscar</span>
            </button>
            <button id="nav-favs" class="nav-btn" onclick="loadView('favs')">
                <i>‚ù§Ô∏è</i> <span>Lista</span>
            </button>
            <button id="nav-clean" class="nav-btn" style="margin-top:auto;" onclick="borrarCaches()">
                <i>üßπ</i> <span>Limpiar</span>
            </button>
        </div>

        <div class="content-area">
            
            <div id="view-home" class="view-section">
                <div class="meta-info">
                    <div class="meta-tag" id="meta-tag">ESTRENO</div>
                    <h1 class="meta-title" id="meta-title">Cargando...</h1>
                    <p class="meta-desc" id="meta-desc">...</p>
                </div>

                <div class="rows-container">
                    <div class="row-title">üî• Estrenos Recientes</div>
                    <div class="row-scroller" id="row-latest"></div>

                    <div class="row-title">‚ù§Ô∏è Tu Lista</div>
                    <div class="row-scroller" id="row-favs"></div>
                </div>
            </div>

            <div id="view-search" class="search-container">
                <h1 style="margin-bottom: 20px;">Buscador</h1>
                <input type="text" id="search-input" class="search-input" placeholder="Escribe el nombre del anime...">
                <div class="rows-container">
                    <div class="row-scroller" id="search-results" style="flex-wrap: wrap; overflow-y: auto;"></div>
                </div>
            </div>

            <div id="view-favs" class="search-container">
                <h1>Mi Lista</h1>
                <div class="rows-container">
                    <div class="row-scroller" id="favs-grid" style="flex-wrap: wrap; overflow-y: auto;"></div>
                </div>
            </div>

        </div>
    </div>

    <div id="modal-detail" class="modal">
        <div class="modal-content">
            <img id="mod-img" class="modal-img">
            <div class="modal-info">
                <h2 id="mod-title" class="modal-title">Titulo</h2>
                <p id="mod-desc" class="modal-desc">Descripcion...</p>
                <div class="action-row">
                    <button id="btn-play" class="btn-action btn-primary">‚ñ∂ Reproducir</button>
                    <button id="btn-fav" class="btn-action btn-sec">Lista</button>
                    <button onclick="closeModal()" class="btn-action btn-sec">Cerrar</button>
                </div>
                <h3>Episodios</h3>
                <div id="mod-episodes" class="ep-grid"></div>
            </div>
        </div>
    </div>

    <div id="player-overlay" class="player-overlay">
        <div id="server-selector" class="server-selector">
            <h2 class="server-title">Elige un Servidor</h2>
            <div id="server-list" class="server-list"></div>
            <button onclick="closePlayer()" class="server-btn" style="margin-top:40px; background:#555;">Cancelar</button>
        </div>

        <div id="player-container" style="width:100%; height:100%;"></div>
        <button class="close-player" onclick="closePlayer()">‚úï Salir</button>
    </div>

    <script src="app_tv.js?v=final_validated"></script>
</body>
</html>